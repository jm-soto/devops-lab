version: '3'

# ========================================
# TAREAS DE DOCKER
# ========================================

tasks:
  build:
    desc: ðŸ³ Construir imagen de la aplicaciÃ³n
    cmds:
      - docker build -t {{.IMAGE_NAME}} .

  run:
    desc: ðŸ³ Ejecutar aplicaciÃ³n en contenedor
    cmds:
      - docker run --rm -p 3000:3000
        -e BACKGROUND_COLOR={{.BACKGROUND_COLOR | default .DEFAULT_BG_COLOR}}
        -e APP_VERSION={{.APP_VERSION | default .DEFAULT_VERSION}}
        --name {{.CONTAINER_NAME}}
        {{.IMAGE_NAME}}

  run-detached:
    desc: ðŸ³ Ejecutar aplicaciÃ³n en background
    cmds:
      - docker run -d -p 3000:3000
        -e BACKGROUND_COLOR={{.BACKGROUND_COLOR | default .DEFAULT_BG_COLOR}}
        -e APP_VERSION={{.APP_VERSION | default .DEFAULT_VERSION}}
        --name {{.CONTAINER_NAME}}
        {{.IMAGE_NAME}}

  dev:
    desc: ðŸ³ Ejecutar en modo desarrollo con volÃºmenes
    cmds:
      - docker run --rm -it -p 3000:3000
        -v {{.PWD}}/app:/app
        -w /app
        -e BACKGROUND_COLOR={{.BACKGROUND_COLOR | default .DEFAULT_BG_COLOR}}
        -e APP_VERSION={{.APP_VERSION | default .DEFAULT_VERSION}}
        node:alpine
        sh -c "npm install && npm start"

  stop:
    desc: ðŸ³ Detener contenedor
    cmds:
      - docker stop {{.CONTAINER_NAME}} 2>/dev/null || true
      - docker rm {{.CONTAINER_NAME}} 2>/dev/null || true

  clean:
    desc: ðŸ³ Limpiar contenedores e imÃ¡genes
    cmds:
      - docker stop {{.CONTAINER_NAME}} 2>/dev/null || true
      - docker rm {{.CONTAINER_NAME}} 2>/dev/null || true
      - docker rmi {{.IMAGE_NAME}} 2>/dev/null || true
      - echo "âœ“ Limpieza completada"